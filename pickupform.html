<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DropMyElectronic | Donate E-Waste</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;transition:all .3s ease}
        :root{--primary:#2e7d32;--secondary:#ff9800;--text:#333;--bg:#f5f5f5;--card:#fff;--shadow:0 4px 6px rgba(0,0,0,0.1)}
        .dark-mode{--primary:#4caf50;--secondary:#ffb74d;--text:#e0e0e0;--bg:#121212;--card:#2d2d2d;--shadow:0 4px 6px rgba(0,0,0,0.3)}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea15,#764ba215);color:var(--text);min-height:100vh}
        .container{width:90%;max-width:800px;margin:0 auto;padding:20px}
        .header{display:flex;justify-content:space-between;align-items:center;padding:20px 0}
        .logo{font-size:1.8rem;font-weight:700;color:var(--primary);text-decoration:none}
        .back-btn{color:var(--text);text-decoration:none;display:flex;align-items:center;gap:8px;margin-bottom:20px}
        .hero{text-align:center;margin-bottom:40px}
        .hero h1{font-size:2.5rem;color:var(--primary);margin-bottom:20px}
        .hero p{font-weight:600;color:var(--primary)}
        .steps{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:40px}
        .step{text-align:center;padding:20px;background:var(--card);border-radius:16px;box-shadow:var(--shadow)}
        .step i{font-size:2rem;color:var(--primary);margin-bottom:10px}
        .step p{color:#6b7280;font-size:.95rem}
        .pickup-section{background:var(--card);border-radius:20px;padding:40px;box-shadow:var(--shadow);margin-bottom:40px}
        .pickup-section h2{display:flex;align-items:center;gap:10px;margin-bottom:30px;color:var(--primary)}
        .form-group{margin-bottom:25px}
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
        label{display:block;margin-bottom:8px;font-weight:600}
        input,textarea{width:100%;padding:14px 16px;border:2px solid #e0e0e0;border-radius:12px;font-size:1rem;background:var(--card);color:var(--text)}
        input:focus,textarea:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px rgba(46,125,50,0.1)}
        .location-box{position:relative}
        .location-box i{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:var(--primary)}
        .btn{background:var(--primary);color:#fff;padding:16px 32px;border-radius:12px;font-weight:600;border:none;cursor:pointer;font-size:1.1rem;width:100%}
        .btn:hover{background:#1b5e20;transform:translateY(-2px)}
        .dark-mode-switch{position:relative;width:34px;height:18px;background:#ccc;border-radius:34px}
        .dark-mode-switch::after{content:'';position:absolute;top:2px;left:2px;width:14px;height:14px;background:#fff;border-radius:50%;transition:.3s}
        #dark-mode-checkbox:checked+.dark-mode-switch::after{transform:translateX(16px)}
        #dark-mode-checkbox{display:none}
        .dark-mode-label{display:flex;align-items:center;gap:10px;cursor:pointer}
        .footer-text{text-align:center;color:#6b7280;margin-top:20px}
        .recycler-match{background:var(--bg);border-radius:16px;padding:20px;margin-top:20px;border:2px solid var(--primary)}
        .recycler-match h3{color:var(--primary);margin-bottom:15px;display:flex;align-items:center;gap:10px}
        .match-card{background:var(--card);border-radius:12px;padding:20px;margin-bottom:15px;border:2px solid transparent;cursor:pointer;transition:all .2s ease}
        .match-card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
        .match-card.selected{border-color:var(--primary);background:rgba(46,125,50,0.05)}
        .match-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .match-name{font-size:1.2rem;font-weight:600}
        .match-rating{background:var(--primary);color:#fff;padding:4px 10px;border-radius:20px;font-size:.8rem}
        .match-details{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:15px 0}
        .match-detail{text-align:center}
        .match-detail .label{font-size:.7rem;color:#6b7280;text-transform:uppercase}
        .match-detail .value{font-size:1.1rem;font-weight:600}
        .selection-indicator{text-align:right;color:var(--primary);font-size:.9rem;margin-top:5px}
        .spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 1s infinite;margin-right:10px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .hidden{display:none!important}
        .email-preview{background:#f0f9ff;border-radius:12px;padding:20px;margin:20px 0;border-left:4px solid var(--primary);font-family:monospace;font-size:.9rem;text-align:left;white-space:pre-wrap}
        .dark-mode .email-preview{background:#1e293b;color:#e2e8f0}
        .warning-box{background:#fff3cd;border:1px solid #ffeeba;color:#856404;padding:15px;border-radius:8px;margin:20px 0}
        @media (max-width:768px){.steps,.form-row{grid-template-columns:1fr}.hero h1{font-size:2rem}.match-details{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <a href="index.html" class="logo">DropMyElectronic</a>
        <div class="dark-mode-toggle">
            <label for="dark-mode-checkbox" class="dark-mode-label">
                <i class="fas fa-moon"></i><span>Dark Mode</span>
                <input type="checkbox" id="dark-mode-checkbox">
                <div class="dark-mode-switch"></div>
            </label>
        </div>
    </div>
    
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
    
    <div class="hero">
        <h1>Donate E-Waste</h1>
        <p>Together, we're turning waste into opportunity.</p>
    </div>
    
    <div class="steps">
        <div class="step"><i class="fas fa-map-marked-alt"></i><p>Enter location</p></div>
        <div class="step"><i class="fas fa-box"></i><p>Pack items securely</p></div>
        <div class="step"><i class="fas fa-truck"></i><p>Choose recycler</p></div>
    </div>
    
    <div class="pickup-section">
        <h2><i class="fas fa-truck"></i> Request Pickup</h2>
        
        <form id="donationForm">
            <div class="form-row">
                <div class="form-group"><label>üë§ Name</label><input type="text" id="name" placeholder="Enter your full name" required></div>
                <div class="form-group"><label>üìû Phone</label><input type="tel" id="phone" placeholder="+254 712 345 678" required></div>
            </div>
            <div class="form-group"><label>‚úâÔ∏è Email</label><input type="email" id="email" placeholder="your@email.com" required></div>
            <div class="form-group">
                <label>üìç Location</label>
                <div class="location-box"><input type="text" id="location" placeholder="e.g., Nairobi, Westlands" required><i class="fas fa-map-marker-alt"></i></div>
            </div>
            <div class="form-group"><label>üìù Items</label><textarea id="items" rows="3" placeholder="Describe your e-waste items (e.g., 2 old TVs, 3 phones, 1 laptop...)" required></textarea></div>
            <button type="submit" id="submitBtn" class="btn"><span id="btnText">üîç Find Recyclers</span><span id="btnLoading" class="hidden"><span class="spinner"></span> Finding...</span></button>
        </form>
        
        <div id="matchesSection" class="hidden">
            <div class="recycler-match">
                <h3><i class="fas fa-recycle"></i> Select Recycler</h3>
                <div id="matchesList"></div>
                <div id="selectionStatus" class="hidden" style="margin:15px 0;padding:10px;background:var(--bg);border-radius:8px;text-align:center;">‚úÖ <span id="selectedName"></span> selected</div>
                <button onclick="confirm()" id="confirmBtn" class="btn" style="background:var(--secondary);margin-top:20px;" disabled>‚úÖ Confirm Request</button>
            </div>
        </div>
        
        <div id="successMessage" class="hidden" style="text-align:center;margin-top:30px;padding:20px;background:#f0fdf4;border-radius:12px;color:#166534">
            <i class="fas fa-check-circle" style="font-size:3rem;margin-bottom:10px;"></i>
            <h3>Request Received!</h3>
            <div id="successDetails" style="margin-top:15px;"></div>
            <div class="email-preview" id="emailPreview"><strong>üìß Email Preview (not sent):</strong><br><div id="emailContent"></div></div>
            <button onclick="reset()" class="btn" style="margin-top:20px;background:var(--secondary);">üìÖ New Request</button>
        </div>
    </div>
    
    <div class="footer-text"><p>‚ôªÔ∏è Turning e-waste into opportunity</p></div>
</div>

<script>
// Dark Mode
(() => {
    const t = document.getElementById('dark-mode-checkbox'), b = document.body;
    (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) && (b.classList.add('dark-mode'), t.checked = true, document.querySelector('.dark-mode-label i').className = 'fas fa-sun', document.querySelector('.dark-mode-label span').textContent = 'Light Mode');
    t.addEventListener('change', () => {
        b.classList.toggle('dark-mode');
        const isDark = b.classList.contains('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        document.querySelector('.dark-mode-label i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        document.querySelector('.dark-mode-label span').textContent = isDark ? 'Light Mode' : 'Dark Mode';
    });
})();

// Data
const R = [
    {id:1,n:"WEEE Centre",lat:-1.2784,lng:36.9527,a:"Mihango, Embakasi",p:"0701819559",rt:4.8,sp:"2-4h",e:"weecentre@ex.com"},
    {id:2,n:"Safaricom E-Waste",lat:-1.2733,lng:36.8067,a:"Westlands, Nairobi",p:"0722000000",rt:4.6,sp:"1-3h",e:"ewaste@safaricom.co.ke"},
    {id:3,n:"ECANDI",lat:-1.2157,lng:36.7973,a:"Limuru Rd, Nairobi",p:"0741777986",rt:4.9,sp:"3-5h",e:"info@ecandi.org"},
    {id:4,n:"GreenTech",lat:-1.2763,lng:36.8267,a:"Ngara, Nairobi",p:"0722969219",rt:4.7,sp:"2-4h",e:"greentech@ex.com"}
];

const areas = {
    nairobi:[-1.2864,36.8172],cbd:[-1.2864,36.8172],westlands:[-1.2659,36.8067],
    kilimani:[-1.2950,36.7860],karen:[-1.3159,36.8342],embakasi:[-1.3076,36.9182],
    kasarani:[-1.2186,36.8925],ngong:[-1.3000,36.7800],thika:[-1.2300,36.8700]
};

let matches = [], form = {}, selId = null;

const $ = id => document.getElementById(id);
const dist = (lat1,lng1,lat2,lng2) => {
    const R=6371, dLat=(lat2-lat1)*Math.PI/180, dLng=(lng2-lng1)*Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
};

const getCoord = loc => {
    loc = loc.toLowerCase().trim();
    for(let [k,c] of Object.entries(areas)) if(loc.includes(k)||k.includes(loc)) return {lat:c[0],lng:c[1]};
    return {lat:-1.2864,lng:36.8172};
};

const findNear = (lat,lng) => R.map(r => ({...r, d:dist(lat,lng,r.lat,r.lng)})).sort((a,b)=>a.d-b.d).slice(0,4);

const select = id => {
    selId = id;
    document.querySelectorAll('.match-card').forEach(c => c.classList.toggle('selected', parseInt(c.dataset.id)===id));
    const s = matches.find(r=>r.id===id);
    if(s) { $('selectedName').textContent = s.n; $('selectionStatus').classList.remove('hidden'); $('confirmBtn').disabled = false; }
};

$('donationForm').addEventListener('submit', e => {
    e.preventDefault();
    form = {n:$('name').value, p:$('phone').value, e:$('email').value, l:$('location').value, i:$('items').value};
    if(!form.n||!form.p||!form.e||!form.l||!form.i) return alert('Fill all fields');
    
    selId = null;
    $('btnText').classList.add('hidden'); $('btnLoading').classList.remove('hidden'); $('submitBtn').disabled = true;
    
    setTimeout(() => {
        const c = getCoord(form.l);
        matches = findNear(c.lat, c.lng);
        
        $('btnText').classList.remove('hidden'); $('btnLoading').classList.add('hidden'); $('submitBtn').disabled = false;
        $('donationForm').classList.add('hidden');
        
        $('matchesList').innerHTML = matches.map((r,i) => `
            <div class="match-card" data-id="${r.id}" onclick="select(${r.id})">
                <div class="match-header"><span class="match-name">${i+1}. ${r.n}</span><span class="match-rating">‚≠ê ${r.rt}</span></div>
                <p><i class="fas fa-map-marker-alt"></i> ${r.a}</p>
                <p><i class="fas fa-phone"></i> ${r.p}</p>
                <div class="match-details">
                    <div class="match-detail"><span class="label">Distance</span><span class="value">${r.d.toFixed(1)}km</span></div>
                    <div class="match-detail"><span class="label">Response</span><span class="value">${r.sp}</span></div>
                </div>
                <div class="selection-indicator"><i class="far fa-circle"></i> Click to select</div>
            </div>
        `).join('');
        
        $('matchesSection').classList.remove('hidden');
        $('selectionStatus').classList.add('hidden');
        $('confirmBtn').disabled = true;
    }, 1000);
});

window.confirm = () => {
    if(!selId) return alert('Select a recycler');
    const r = matches.find(r=>r.id===selId), id = 'DME-'+Date.now().toString().slice(-6);
    
    const email = `TO: ${form.e}
FROM: noreply@dropmyelectronic.com
SUBJECT: Pickup Request ${id}

Dear ${form.n},

Request sent to ${r.n} (${r.p}) for pickup at ${form.l}.

Items: ${form.i}

Thank you for helping us turn e-waste into opportunity!`;
    
    $('matchesSection').classList.add('hidden');
    $('successMessage').classList.remove('hidden');
    $('emailContent').innerHTML = email.replace(/\n/g,'<br>');
    $('successDetails').innerHTML = `<strong>ID:</strong> ${id}<br><strong>Recycler:</strong> ${r.n}<br><strong>Email:</strong> ${form.e}`;
    
    console.log('üìß Demo - Email would be sent to:', form.e);
    console.log('üìß Demo - Recycler notified:', r.e);
};

window.reset = () => {
    $('successMessage').classList.add('hidden');
    $('matchesSection').classList.add('hidden');
    $('donationForm').classList.remove('hidden');
    $('donationForm').reset();
    matches = []; form = {}; selId = null;
};
</script>
</body>
</html>